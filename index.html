<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.3">
<meta name="author" content="Peter Ledbrook">
<title>Writing Gradle Plugins</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./coderay-asciidoctor.css">
<link rel="stylesheet" href="https://guides.gradle.org/css/asciidoctor.css">
<link rel="stylesheet" href="https://guides.gradle.org/css/styles.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,400,700|Source+Code+Pro:500">
<link rel="apple-touch-icon" sizes="180x180" href="https://guides.gradle.org/icon/apple-touch-icon.png">
<link rel="icon" type="image/png" href="https://guides.gradle.org/icon/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://guides.gradle.org/icon/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="https://guides.gradle.org/icon/manifest.json">
<link rel="mask-icon" href="https://guides.gradle.org/icon/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="https://guides.gradle.org/icon/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Writing Gradle Plugins in Java">
<meta name="application-name" content="Writing Gradle Plugins in Java">
<meta name="msapplication-config" content="https://guides.gradle.org/icon/browserconfig.xml">
<meta name="theme-color" content="#ffffff">
<script defer src="https://guides.gradle.org/js/set-time-to-complete-text.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,"script","https://www.google-analytics.com/analytics.js","ga");
  ga("create", "UA-4207603-1", "auto");
  ga("send", "pageview");
</script>
</head>
<body class="article toc2 toc-right">
<div id="header"><div style="padding-top: 10px;"><a href="https://guides.gradle.org"><img src="https://guides.gradle.org/gradle-guides.svg" alt=""></a></div><h1>Writing Gradle Plugins</h1>
<div class="details">
<span id="author" class="author">Peter Ledbrook</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#what_you_ll_build">What you&#8217;ll build</a></li>
<li><a href="#what_you_ll_need">What you&#8217;ll need</a></li>
<li><a href="#create_a_project">Create a project</a></li>
<li><a href="#create_the_plugin">Create the plugin</a></li>
<li><a href="#use_the_plugin_in_the_main_project">Use the plugin in the main project</a></li>
<li><a href="#declare_a_plugin_identifier">Declare a plugin identifier</a></li>
<li><a href="#summary">Summary</a></li>
<li><a href="#next_steps">Next steps</a></li>
<li><a href="#help_improve_this_guide">Help improve this guide</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This guide walks you through the process of creating reusable build logic in a Gradle plugin, which can then be applied to other Gradle builds. The core of Gradle provides an infrastructure for building anything, but plugins are what allow build script authors to get things done with a minimum of effort, allowing them to focus on <strong>what to build</strong>, rather than <strong>how to build</strong>. Plugins can apply conventions, add new task types, integrate with third-party tools and libraries, and more. For instance, the <code>java</code> plugin provides standard source directory layouts and tasks such as <code>compileJava</code> and <code>compileTestJava</code>. This guide focuses on the most basic of plugins, but represents the tip of the iceberg.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what_you_ll_build"><a class="anchor" href="#what_you_ll_build"></a>What you&#8217;ll build</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You&#8217;ll write a simple plugin that adds a new task type and creates a task of that type in whatever project its applied to. You will also prove that the plugin works and see its effect by applying the plugin to a build.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what_you_ll_need"><a class="anchor" href="#what_you_ll_need"></a>What you&#8217;ll need</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>About <span class="time-to-complete-text">NN</span></p>
</li>
<li>
<p>A text editor or IDE</p>
</li>
<li>
<p>A <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java Development Kit</a> (JDK), version 1.7 or better</p>
</li>
<li>
<p>A <a href="https://gradle.org/install">Gradle distribution</a>, version 4.0 or better</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create_a_project"><a class="anchor" href="#create_a_project"></a>Create a project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You&#8217;ll need to create a directory for this plugin project and switch to it:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ mkdir greeting-plugin
$ cd greeting-plugin</pre>
</div>
</div>
<div class="paragraph">
<p>Next, you will create a special directory structure for the plugin code:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ mkdir -p buildSrc/src/main/java/org/example/greeting</pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you&#8217;d like to learn more about this <code>buildSrc</code> directory, you can read about how it allows you to organize your build logic <a href="https://docs.gradle.org/4.0/userguide/organizing_build_logic.html#sec:build_sources">in the User Manual</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You will often want to publish the plugin so that it can be reused across multiple builds. You can learn about the options to do just that in <a href="#next_steps">Next steps</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="create_the_plugin"><a class="anchor" href="#create_the_plugin"></a>Create the plugin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create the class <code>GreetingPlugin</code> in the directory you just created, setting its contents to the following:</p>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/java/org/example/greeting/GreetingPlugin.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.example.greeting</span>;

<span class="keyword">import</span> <span class="include">org.gradle.api.Plugin</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.Project</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">GreetingPlugin</span> <span class="directive">implements</span> Plugin&lt;Project&gt; {
    <span class="directive">public</span> <span class="type">void</span> apply(Project project) {
        project.getTasks().create(<span class="string"><span class="delimiter">&quot;</span><span class="content">hello</span><span class="delimiter">&quot;</span></span>, Greeting.class, (task) -&gt; { <i class="conum" data-value="1"></i><b>(1)</b>
            task.setMessage(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>);
            task.setRecipient(<span class="string"><span class="delimiter">&quot;</span><span class="content">World</span><span class="delimiter">&quot;</span></span>);                                <i class="conum" data-value="2"></i><b>(2)</b>
        });
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creates a new task named <code>hello</code> of type <code>Greeting</code> (which you will define shortly)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Sets default values for the new task</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is the actual plugin and the Gradle <code>Project</code> object is your access point for the entire Gradle API, which allows you to do the same things as you can do in a build script. In this case, you are creating a simple task called <code>hello</code> in the target project.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Use the Gradle <a href="https://docs.gradle.org/4.0/dsl/">DSL Reference</a> and <a href="https://docs.gradle.org/4.0/javadoc/">Javadocs</a> to learn what you can do with the Gradle API. Start with the entry for <a href="https://docs.gradle.org/4.0/dsl/org.gradle.api.Project.html"><code>Project</code></a>. You can find out more about what you can achieve by also following the links in <a href="#next_steps">Next steps</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, you&#8217;ll create the class for the task type that the plugin is using. Add a new <code>Greeting</code> class in the same package as the plugin:</p>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/java/org/example/greeting/Greeting.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">org.example.greeting</span>;

<span class="keyword">import</span> <span class="include">org.gradle.api.DefaultTask</span>;
<span class="keyword">import</span> <span class="include">org.gradle.api.tasks.TaskAction</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">Greeting</span> <span class="directive">extends</span> DefaultTask {
    <span class="directive">private</span> <span class="predefined-type">String</span> message;
    <span class="directive">private</span> <span class="predefined-type">String</span> recipient;

    <span class="directive">public</span> <span class="predefined-type">String</span> getMessage() { <span class="keyword">return</span> message; }
    <span class="directive">public</span> <span class="type">void</span> setMessage(<span class="predefined-type">String</span> message) { <span class="local-variable">this</span>.message = message; }

    <span class="directive">public</span> <span class="predefined-type">String</span> getRecipient() { <span class="keyword">return</span> recipient; }
    <span class="directive">public</span> <span class="type">void</span> setRecipient(<span class="predefined-type">String</span> recipient) { <span class="local-variable">this</span>.recipient = recipient; }

    <span class="annotation">@TaskAction</span>
    <span class="type">void</span> sayGreeting() {
        <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">%s, %s!</span><span class="char">\n</span><span class="delimiter">&quot;</span></span>, getMessage(), getRecipient()); <i class="conum" data-value="1"></i><b>(1)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Prints out the configured greeting when the task runs</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can learn more about creating your own task types in the <a href="https://docs.gradle.org/4.0/userguide/custom_tasks.html">User Manual</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You now have a plugin, but a plugin alone doesn&#8217;t do anything. You need to apply it to a project using the <code>apply</code> keyword for it to be useful, so we will show you how to do that next.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="use_the_plugin_in_the_main_project"><a class="anchor" href="#use_the_plugin_in_the_main_project"></a>Use the plugin in the main project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create a <code>build.gradle</code> file in the root of the project with the following contents:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: org.example.greeting.GreetingPlugin <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This applies your plugin to the current <code>Project</code> instance, adding the <code>hello</code> task to the build.</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The above syntax is all that&#8217;s required because the plugin source resides in the <code>buildSrc</code> directory. Applying other, non-core Gradle plugins requires other syntax as described in the <a href="https://docs.gradle.org/4.0/userguide/plugins.html#sec:binary_plugins">User Manual</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can now verify that your plugin is working by running its <code>hello</code> task in the main build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle hello
:buildSrc:compileJava
:buildSrc:compileGroovy UP-TO-DATE
:buildSrc:processResources UP-TO-DATE
:buildSrc:classes
:buildSrc:jar
:buildSrc:assemble
:buildSrc:compileTestJava UP-TO-DATE
:buildSrc:compileTestGroovy UP-TO-DATE
:buildSrc:processTestResources UP-TO-DATE
:buildSrc:testClasses UP-TO-DATE
:buildSrc:test UP-TO-DATE
:buildSrc:check UP-TO-DATE
:buildSrc:build
:hello
Hello, World!</pre>
</div>
</div>
<div class="paragraph">
<p>The bulk of the output reflects that the files in <code>buildSrc</code> are treated as a Java project, which needs to be built first. Once that happens, the classes inside that project become available in your main build and the main build can execute the task or tasks that you specified.</p>
</div>
<div class="paragraph">
<p>Your build is currently just using the default property values for the greeting, hence why it prints out "Hello, World!". This doesn&#8217;t have to be the case as you can configure the task directly in the build script:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: org.example.greeting.GreetingPlugin

hello { <i class="conum" data-value="1"></i><b>(1)</b>
    message = <span class="string"><span class="delimiter">&quot;</span><span class="content">Hi</span><span class="delimiter">&quot;</span></span>
    recipient = <span class="string"><span class="delimiter">&quot;</span><span class="content">Gradle</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configures multiple properties of the task named <code>hello</code></td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can learn more about the syntax for configuring tasks in the <a href="https://docs.gradle.org/4.0/userguide/more_about_tasks.html#sec:configuring_tasks">User Manual</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now when you run the <code>hello</code> task&#8201;&#8212;&#8201;using <code>-q</code> to hide the <code>buildSrc</code> output this time&#8201;&#8212;&#8201;you&#8217;ll see the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ gradle -q hello
Hi, Gradle!</pre>
</div>
</div>
<div class="paragraph">
<p>Your plugin is now functionally complete and you&#8217;ve seen it in action in the above build. There is just one more thing we want to show you, which helps make the build script a bit tidier and also helps when it comes to publishing your plugin: adding a plugin identifier.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="declare_a_plugin_identifier"><a class="anchor" href="#declare_a_plugin_identifier"></a>Declare a plugin identifier</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In most cases, you apply plugins using an ID because they are easier to remember than fully-qualified class names. They also result in tidier build files. So it makes sense to ensure that your own plugin can also be applied in the same way, which is why you will now declare an identifier for the plugin.</p>
</div>
<div class="paragraph">
<p>Create the following properties file:</p>
</div>
<div class="listingblock">
<div class="title">buildSrc/src/main/resources/META-INF/gradle-plugins/org.example.greeting.properties</div>
<div class="content">
<pre>implementation-class=org.example.greeting.GreetingPlugin</pre>
</div>
</div>
<div class="paragraph">
<p>Gradle uses this file to determine which class implements the <code>Plugin</code> interface. The name of this properties file excluding the <code>.properties</code> extension becomes the identifier of the plugin.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
You must put the properties file in the directory <code>META-INF/gradle-plugins</code> as Gradle will try to resolve the file from that specific location in the plugin JAR.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>That&#8217;s all you need to do in your plugin, so now you can replace the following line of the build script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: org.example.greeting.GreetingPlugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>with one that uses the plugin ID:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">org.example.greeting</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note how the name of the properties file&#8201;&#8212;&#8201;<code>org.example.greeting.properties</code>&#8201;&#8212;&#8201;maps to the ID above.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Always qualify the plugin name with a namespace that is unique to you instead of the "org.example" used in this guide. Doing so helps avoid name clashes between plugins. You can find more details about plugin IDs in the <a href="https://docs.gradle.org/4.0/userguide/custom_plugins.html#sec:creating_a_plugin_id">User Manual</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="summary"><a class="anchor" href="#summary"></a>Summary</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You&#8217;re now done! You have successfully created a plugin and used it within a build. Along the way, you&#8217;ve learned how to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Put build logic into a plugin</p>
</li>
<li>
<p>Use the <code>buildSrc</code> directory for a plugin&#8217;s classes</p>
</li>
<li>
<p>Give the plugin an ID and apply it in a build script</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This guide focuses on the essence of what a plugin is, but most plugins are far more substantial in the features that they provide. The next section will guide you towards learning more about what plugins can do and how you should implement them.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next_steps"><a class="anchor" href="#next_steps"></a>Next steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you&#8217;re familiar with the basics of building Gradle plugins, you may be interested in:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.gradle.org/4.0/userguide/javaGradle_plugin.html">Simplifying plugin development with the Java Gradle Plugin Development Plugin</a></p>
</li>
<li>
<p><a href="https://guides.gradle.org/publishing-plugins-to-gradle-plugin-portal/">Publishing plugins to the Gradle Plugin Portal</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/4.0/userguide/custom_plugins.html#sec:getting_input_from_the_build">Modeling your domain with extensions</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/4.0/userguide/test_kit.html">Testing plugins</a></p>
</li>
<li>
<p><a href="https://docs.gradle.org/4.0/userguide/more_about_tasks.html#sec:up_to_date_checks">Adding incremental build support to new task types</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1 contribute">
<h2 id="help_improve_this_guide"><a class="anchor" href="#help_improve_this_guide"></a>Help improve this guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Have feedback or a question? Found a typo? Like all Gradle guides, help is just a GitHub issue away. Please add an issue or pull request to <a href="https://github.com/gradle-guides/writing-gradle-plugins-in-java/">gradle-guides/writing-gradle-plugins-in-java</a> and we&#8217;ll get back to you.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-07-12 12:51:04 UTC
</div>
</div>
</body>
</html>